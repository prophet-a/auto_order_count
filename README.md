# Обробка Військових Наказів

Проєкт для автоматизованої обробки військових наказів з метою витягнення структурованої інформації про військовослужбовців, їх переміщення, зміни статусу тощо.

## Як користуватись

Для обробки файлу наказу `.docx` запустіть скрипт так:

```bash
python main.py <файл_наказу.docx> [опції]
```

**Основні опції:**

*   Без опцій: Результат збережеться у `results.json`.
*   `-o <файл.json>`: Зберегти результат в інший JSON файл.
*   `-x <файл.xlsx>`: Зберегти результат також і в Excel файл.
    (Скрипт автоматично шукає файл конфігурації `config.json` в поточній директорії).

**Приклади:**

*   `python main.py nakaz.docx` (збереже в `results.json`, використає `config.json`)
*   `python main.py my_order.docx -o data.json` (збереже в `data.json`, використає `config.json`)
*   `python main.py order1.docx -x report.xlsx` (збереже в `results.json` та `report.xlsx`, використає `config.json`)
*   `python main.py input.docx -o out.json -x out.xlsx` (збереже в `out.json` та `out.xlsx`, використає `config.json`)

## Структура проєкту

```
.
├── README.md                  # Цей файл
├── main.py                    # Основний скрипт для запуску
├── text_processing.py         # Модуль для обробки тексту
├── section_detection.py       # Модуль для виявлення секцій
├── military_personnel.py      # Модуль для обробки даних про військовослужбовців
├── utils.py                   # Допоміжні функції
├── config.json                # Конфігураційний файл
├── name_converter.py          # Модуль для нормалізації ПІБ
└── processors/                # Пакет з процесорами для різних типів секцій
    ├── __init__.py
    └── arrival_processor.py   # Обробник розділів про прибуття
```

## Опис модулів

### text_processing.py
- `normalize_text()` - нормалізація тексту
- `remove_section_content()` - видалення вмісту секції
- `should_exclude_record()` - перевірка на виключення запису
- `get_subsection_cause()` - отримання причини з підсекції

### section_detection.py
- `find_sections()` - пошук секцій у документі
- `detect_section_type()` - визначення типу секції за контекстом
- `extract_section_date()` - вилучення дати з секції
- `extract_meal_info()` - вилучення інформації про котлове забезпечення

### military_personnel.py
- `extract_military_personnel()` - вилучення записів про військовослужбовців
- `extract_rank_and_name()` - вилучення звання та імені
- `extract_military_unit()` - вилучення військової частини
- `create_personnel_record()` - створення запису про військовослужбовця

### processors/
- `arrival_processor.py` - обробка прибуття
  - `process_arrival_at_assignment()` - обробка прибуття у відрядження
  - `process_arrival_at_training()` - обробка прибуття на навчання

- `vacation_processor.py` - обробка відпусток
  - `process_vacation()` - обробка відпусток

- `mobilization_processor.py` - обробка мобілізації
  - `process_mobilization()` - обробка мобілізації
  - `search_mob()` - пошук мобілізаційних записів

- `departure_processor.py` - обробка вибуття
  - `process_departure()` - обробка вибуття

### utils.py
- `parse_date()` - розбір дати
- `is_person_duplicate()` - перевірка на дублікат
- `extract_location()` - вилучення локації
- `extract_vch()` - вилучення військової частини

### main.py
- `process_military_order()` - головна функція обробки документу
- `load_config()` - завантаження конфігурації (звання, локації)
- `save_results()` - збереження результатів

### name_converter.py
- `process_full_name()` - перетворення ПІБ з родового в називний відмінок

## Розширення проєкту

Для додавання обробки нових типів секцій:

1. Створіть новий файл у директорії `processors/` для відповідного типу (наприклад, `vacation_processor.py`)
2. Реалізуйте функції обробки специфічних секцій
3. Додайте імпорт та обробку нових типів секцій у `main.py`

## Результати

Результати обробки зберігаються у форматі JSON, кожен запис містить наступні поля:
- `rank` - звання військовослужбовця
- `name` - повне ім'я (в родовому відмінку з наказу)
- `name_normal` - нормалізоване ПІБ (ПРІЗВИЩЕ Ім'я По-батькові) в називному відмінку
- `VCH` - військова частина
- `location` - локація
- `OS` - тип особового складу
- `date_k` - дата
- `meal` - інформація про харчування
- `cause` - причина (тип запису)

## Аналіз логіки проєкту

1.  **Мета:** Проєкт призначений для автоматичної обробки текстових файлів військових наказів (у форматі `.docx`). Головна задача — витягти структуровану інформацію про переміщення та статус військовослужбовців з тексту наказу.
2.  **Вхідні дані:**
    *   Файл наказу (`.docx`).
    *   Файл конфігурації (`config.json`), який містить допоміжні дані, такі як відповідність звань (`rank_map`) та ключові слова для визначення локацій (`location_triggers`).
3.  **Процес обробки (`main.py`):**
    *   Скрипт запускається з командного рядка, приймаючи шлях до файлу наказу, вихідного файлу та файлу конфігурації.
    *   Завантажується конфігурація (`utils.load_config`).
    *   Завантажується сирий (необроблений) текст з `.docx` файлу (`utils.load_doc`).
    *   Основна логіка зосереджена у функції `process_military_order`, яка приймає сирий текст та конфігураційні дані.
    *   **Пошук основного блоку:** Функція намагається знайти основний блок тексту, що стосується прибуття особового складу, за допомогою маркерів "Вважати такими, що прибули..." та "Вважати такими, що вибули...". Пошук ведеться у сирому тексті для більшої надійності. Якщо маркери не знайдено, обробляється весь документ.
    *   **Пошук підсекцій:** У межах знайденого основного блоку (або всього тексту) функція `section_detection.find_sections` шукає підсекції, що відповідають різним типам подій (наприклад, "Прибуття у відрядження", "З лікувального закладу", "Повернення з відрядження", "ППОС", "Відпустка"). Пошук базується на списку маркерів `specific_section_markers`. Важливо, що `find_sections` працює з сирим текстом знайденого блоку.
    *   **Обробка підсекцій:** Кожна знайдена підсекція (з її сирим текстом) передається відповідному процесору з директорії `processors/` (наприклад, `process_arrival_at_assignment`, `process_hospital_return` тощо).
    *   **Витягнення даних:** Кожен процесор аналізує сирий текст своєї підсекції, використовуючи регулярні вирази, мапу звань та тригери локацій з конфігурації, щоб витягти структуровані дані про військовослужбовців (ПІБ, звання, дата, причина переміщення, місцезнаходження тощо). Використовується множина `processed_persons` для уникнення дублювання записів між секціями.
    *   **Агрегація результатів:** Результати роботи всіх процесорів збираються у єдиний список.
    *   **Збереження:** Фінальний список результатів зберігається у JSON файл (`utils.save_results`), шлях до якого вказується при запуску (за замовчуванням `results.json`).
4.  **Ключові модулі:**
    *   `main.py`: Головний скрипт, оркеструє процес.
    *   `utils.py`: Допоміжні функції (завантаження/збереження файлів, конфігурації).
    *   `text_processing.py`: Функції для обробки тексту (нормалізація, очищення).
    *   `section_detection.py`: Визначення логічних секцій у тексті наказу.
    *   `processors/`: Модулі для обробки кожного типу секцій.
    *   `military_personnel.py`: Містить логіку, специфічну для роботи з даними військовослужбовців.
5.  **Вихідні дані:** JSON файл зі списком об'єктів, кожен з яких представляє запис про військовослужбовця та подію, що його стосується (прибуття, вибуття, лікарня тощо).

## Класи та об'єкти

### `Document` (document.py)
- Зберігає повний документ та надає методи для роботи з ним

### `Section` (section.py)
- Представляє окрему секцію документа
- Має тип, текст, початкову позицію і кінцеву позицію

### `MilitaryPerson` (person.py)
- Представляє військовослужбовця з усіма атрибутами
- Звання, ім'я, військова частина, локація, тощо

### `MealInfo` (meal.py)
- Інформація про котлове забезпечення
- Тип, дата, тощо 